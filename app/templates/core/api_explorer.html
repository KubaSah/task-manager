{% extends 'base.html' %}
{% block title %}API Explorer{% endblock %}
{% block section_title %}API Explorer{% endblock %}
{% block content %}
<div class="api-header">
    <h1>API Explorer</h1>
    <a class="btn" href="{{ url_for('core.tokens_page') }}">Zarządzaj tokenami</a>
</div>

<div class="card api-endpoints-card">
    <h2 class="api-section-title">Dostępne endpointy</h2>
    <p class="muted">Wszystkie endpointy wymagają uwierzytelnienia (sesja lub Bearer token w nagłówku Authorization).
    </p>
    <div class="grid api-grid">
        {% for ep in endpoints %}
        <div class="card api-endpoint-card">
            <div class="api-endpoint-row">
                <span class="chip api-method-chip">{{ ep.method }}</span>
                <code class="api-path">{{ ep.path }}</code>
            </div>
            <div class="muted api-endpoint-desc">{{ ep.desc }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="card">
    <h2 class="api-section-title">Przykładowa odpowiedź: GET /api/tasks</h2>
    <p class="muted">Poniżej fragment danych z Twoich projektów (max 5 zadań):</p>
    <pre class="api-code-block"><code>{{ sample_tasks_json }}</code></pre>
    <div class="api-params-section">
        <h3 class="api-params-title">Parametry zapytania (opcjonalne):</h3>
        <ul class="muted api-params-list">
            <li><code>page</code> – numer strony (domyślnie 1)</li>
            <li><code>per_page</code> – zadań na stronę (1-100, domyślnie 20)</li>
            <li><code>q</code> – szukaj w tytule/opisie</li>
            <li><code>status</code> – todo, in_progress, done</li>
            <li><code>priority</code> – low, medium, high</li>
            <li><code>project_id</code> – filtruj po projekcie (tylko Twoje projekty)</li>
        </ul>
    </div>
</div>

<div class="card api-usage-card">
    <h2 class="api-section-title">Jak używać API?</h2>
    <ol class="muted api-usage-list">
        <li>Utwórz <a href="{{ url_for('core.tokens_page') }}">token API</a> w zakładce Tokeny.</li>
        <li>Dodaj nagłówek do żądania: <code>Authorization: Bearer &lt;TOKEN&gt;</code></li>
        <li>Wyślij żądanie HTTP do endpointu (np. GET /api/tasks).</li>
        <li>Otrzymasz odpowiedź JSON z danymi lub kodem błędu.</li>
    </ol>
    <p class="muted api-example-note">Przykład (curl):</p>
    <pre class="api-code-block"><code>curl -H "Authorization: Bearer YOUR_TOKEN" \
  {{ request.url_root }}api/tasks?status=todo&per_page=10</code></pre>
</div>
{% endblock %}