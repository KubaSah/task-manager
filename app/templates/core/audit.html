{% extends 'base.html' %}
{% block title %}Audit log{% endblock %}
{% block section_title %}Audit log{% endblock %}
{% block content %}
<div class="page-toolbar">
    <h1 class="heading-no-margin">Audit</h1>
    <form method="get" action="{{ url_for('core.audit_page') }}" class="filter-bar">
        <select name="project" id="project-filter" class="filter-select auto-submit">
            <option value="">Wszystkie projekty</option>
            {% for p in projects %}
            <option value="{{ p.id }}" {% if selected_project==p.id %}selected{% endif %}>{{ p.key }}</option>
            {% endfor %}
        </select>
        {% if selected_project %}
        <a class="btn btn-filter-clear" href="{{ url_for('core.audit_page') }}">✕</a>
        {% endif %}
    </form>
</div>

<div class="grid audit-grid">
    {% for e in logs %}
    <div class="card audit-card">
        <div class="audit-card-header">
            <div><strong>{{ e.action }}</strong> <span class="meta">{{ e.entity_type }} #{{ e.entity_id or '-' }}</span>
            </div>
            <div class="meta">{{ e.created_at }}</div>
        </div>
        <div class="meta audit-card-meta">Projekt: {{ e.project_id or '-' }} • Aktor: {{ e.actor_id or '-' }}
        </div>
        {% if e.meta %}
        <pre class="meta audit-card-pre">{{ e.meta }}</pre>
        {% endif %}
    </div>
    {% else %}
    <div class="muted">Brak wpisów audytu</div>
    {% endfor %}
</div>
<div class="audit-pagination">
    <div class="meta">Strona {{ page }} / {{ pages }} • Łącznie: {{ total }}</div>
    <div class="audit-pagination-buttons">
        {% if page > 1 %}<a class="btn"
            href="{{ url_for('core.audit_page', page=page-1, project=selected_project if selected_project else '') }}">Poprzednia</a>{%
        endif %}
        {% if page < pages %}<a class="btn"
            href="{{ url_for('core.audit_page', page=page+1, project=selected_project if selected_project else '') }}">
            Następna</a>{%
            endif %}
            <a class="btn"
                href="{{ url_for('core.audit_export', project=selected_project if selected_project else '') }}">Export
                CSV</a>
    </div>
</div>
{% endblock %}